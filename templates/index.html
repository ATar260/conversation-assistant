<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Assistant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Background blur overlay */
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 1;
        }

        .background-overlay.active {
            opacity: 1;
        }

        /* Main container */
        .siri-container {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-align: center;
            transition: all 0.3s ease;
        }

        /* Siri Orb */
        .siri-orb {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            background: radial-gradient(circle at 30% 30%, 
                rgba(255, 255, 255, 0.8) 0%, 
                rgba(255, 255, 255, 0.4) 30%, 
                rgba(255, 255, 255, 0.1) 70%, 
                transparent 100%);
            box-shadow: 
                0 0 60px rgba(255, 255, 255, 0.3),
                inset 0 0 60px rgba(255, 255, 255, 0.1);
        }

        .siri-orb.listening {
            animation: siriPulse 1.5s ease-in-out infinite;
            background: radial-gradient(circle at 30% 30%, 
                rgba(0, 122, 255, 0.8) 0%, 
                rgba(88, 86, 214, 0.6) 30%, 
                rgba(175, 82, 222, 0.4) 70%, 
                rgba(255, 45, 85, 0.2) 100%);
            box-shadow: 
                0 0 80px rgba(0, 122, 255, 0.4),
                inset 0 0 60px rgba(0, 122, 255, 0.2);
        }

        .siri-orb.thinking {
            animation: siriThinking 2s ease-in-out infinite;
            background: radial-gradient(circle at 30% 30%, 
                rgba(88, 86, 214, 0.8) 0%, 
                rgba(175, 82, 222, 0.6) 30%, 
                rgba(255, 45, 85, 0.4) 70%, 
                rgba(255, 149, 0, 0.2) 100%);
        }

        /* Waveform animation */
        .waveform {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .siri-orb.listening .waveform {
            opacity: 1;
            animation: waveformPulse 1.5s ease-in-out infinite;
        }

        .waveform::before,
        .waveform::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.6);
        }

        .waveform::before {
            width: 60px;
            height: 60px;
            animation: waveformExpand 1.5s ease-in-out infinite;
        }

        .waveform::after {
            width: 80px;
            height: 80px;
            animation: waveformExpand 1.5s ease-in-out infinite 0.3s;
        }

        /* Title */
        .title-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            text-align: center;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .title-container.hidden {
            opacity: 0;
        }

        .main-title {
            color: rgba(255, 255, 255, 0.95);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
            font-weight: 400;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        /* Status text */
        .status-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 10px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        /* Instruction text */
        .instruction-text {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            font-weight: 400;
            margin-top: 15px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            opacity: 0.8;
        }

        .instruction-text.hidden {
            opacity: 0;
        }

        /* Control buttons */
        .control-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        .control-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .start-btn {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.8), rgba(88, 86, 214, 0.8));
        }

        .start-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(0, 122, 255, 1), rgba(88, 86, 214, 1));
        }

        .stop-btn {
            background: linear-gradient(135deg, rgba(255, 45, 85, 0.8), rgba(255, 149, 0, 0.8));
        }

        .stop-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(255, 45, 85, 1), rgba(255, 149, 0, 1));
        }

        .btn-icon {
            font-size: 1.2rem;
        }

        .btn-text {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* Live transcript */
        .transcript-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            max-width: 600px;
            width: 90%;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .transcript-container.active {
            opacity: 1;
        }

        .live-transcript {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px 30px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-weight: 500;
            line-height: 1.4;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* AI Response Cards */
        .response-container {
            position: fixed;
            bottom: 300px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 5;
            max-width: 500px;
            width: 90%;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .response-container.active {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .response-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            line-height: 1.5;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: cardSlideIn 0.5s ease;
        }

        /* Connection indicator */
        .connection-indicator {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 15;
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .connection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff3b30;
            animation: pulse 2s infinite;
        }

        .connection-dot.connected {
            background: #30d158;
        }

        /* Animations */
        @keyframes siriPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 
                    0 0 80px rgba(0, 122, 255, 0.4),
                    inset 0 0 60px rgba(0, 122, 255, 0.2);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 
                    0 0 100px rgba(0, 122, 255, 0.6),
                    inset 0 0 60px rgba(0, 122, 255, 0.3);
            }
        }

        @keyframes siriThinking {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
            }
            25% { 
                transform: scale(1.02) rotate(2deg);
            }
            75% { 
                transform: scale(1.02) rotate(-2deg);
            }
        }

        @keyframes waveformPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        @keyframes waveformExpand {
            0% { 
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes cardSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .siri-orb {
                width: 100px;
                height: 100px;
            }
            
            .siri-container {
                bottom: 100px;
            }
            
            .response-container {
                bottom: 250px;
            }
            
            .live-transcript {
                font-size: 1rem;
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Background overlay -->
    <div class="background-overlay" id="backgroundOverlay"></div>

    <!-- Connection indicator -->
    <div class="connection-indicator">
        <div class="connection-dot" id="connectionDot"></div>
        <span id="connectionText">Connecting...</span>
    </div>

    <!-- Title -->
    <div class="title-container" id="titleContainer">
        <h1 class="main-title">Hi, I am Heygent A.I.</h1>
        <p class="subtitle">Your AI conversation assistant</p>
    </div>

    <!-- Main Siri interface -->
    <div class="siri-container">
        <div class="siri-orb" id="siriOrb">
            <div class="waveform"></div>
        </div>
        <div class="status-text" id="statusText">Ready to listen</div>
        <div class="instruction-text" id="instructionText">Press the start button and I will begin to help you</div>
        
        <!-- Control buttons -->
        <div class="control-buttons">
            <button class="control-btn start-btn" id="startBtn" onclick="startListening()">
                <span class="btn-icon">🎤</span>
                <span class="btn-text">Start</span>
            </button>
            <button class="control-btn stop-btn" id="stopBtn" onclick="stopListening()" disabled>
                <span class="btn-icon">⏹️</span>
                <span class="btn-text">Stop</span>
            </button>
        </div>
    </div>

    <!-- Live transcript -->
    <div class="transcript-container" id="transcriptContainer">
        <div class="live-transcript" id="liveTranscript"></div>
    </div>

    <!-- AI Response -->
    <div class="response-container" id="responseContainer">
        <div class="response-card" id="responseCard"></div>
    </div>

    <script>
        const socket = io();
        let isListening = false;
        let mediaRecorder = null;
        let audioChunks = [];

        // DOM elements
        const siriOrb = document.getElementById('siriOrb');
        const statusText = document.getElementById('statusText');
        const connectionDot = document.getElementById('connectionDot');
        const connectionText = document.getElementById('connectionText');
        const backgroundOverlay = document.getElementById('backgroundOverlay');
        const transcriptContainer = document.getElementById('transcriptContainer');
        const liveTranscript = document.getElementById('liveTranscript');
        const responseContainer = document.getElementById('responseContainer');
        const responseCard = document.getElementById('responseCard');
        const titleContainer = document.getElementById('titleContainer');
        const instructionText = document.getElementById('instructionText');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');

        // Socket event handlers
        socket.on('connect', function() {
            connectionDot.classList.add('connected');
            connectionText.textContent = 'Connected';
        });

        socket.on('disconnect', function() {
            connectionDot.classList.remove('connected');
            connectionText.textContent = 'Disconnected';
        });

        socket.on('transcript', function(data) {
            showTranscript(data.text);
        });

        socket.on('suggestion', function(data) {
            showResponse(data.text);
        });

        socket.on('audio_response', function(data) {
            playAudio(data.audio);
        });

        socket.on('error', function(data) {
            showStatus('Error: ' + data.message);
        });

        async function startListening() {
            if (!isListening) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };
                    
                    mediaRecorder.onstop = async () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const reader = new FileReader();
                        reader.onload = () => {
                            const base64Audio = reader.result.split(',')[1];
                            socket.emit('process_audio', { audio: base64Audio });
                        };
                        reader.readAsDataURL(audioBlob);
                    };
                    
                    // Start recording in 5-second chunks
                    mediaRecorder.start();
                    setInterval(() => {
                        if (mediaRecorder && mediaRecorder.state === 'recording') {
                            mediaRecorder.stop();
                            mediaRecorder.start();
                        }
                    }, 5000);
                    
                    socket.emit('start_listening');
                    isListening = true;
                    
                    // Update UI with safe element access
                    if (siriOrb) siriOrb.classList.add('listening');
                    if (statusText) statusText.textContent = 'Listening...';
                    if (backgroundOverlay) backgroundOverlay.classList.add('active');
                    if (titleContainer) titleContainer.classList.add('hidden');
                    if (instructionText) instructionText.classList.add('hidden');
                    
                    // Update button states
                    if (startBtn) startBtn.disabled = true;
                    if (stopBtn) stopBtn.disabled = false;
                    
                } catch (error) {
                    showStatus('Error accessing microphone: ' + error.message);
                }
            }
        }

        function stopListening() {
            if (isListening) {
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
                if (mediaRecorder && mediaRecorder.stream) {
                    mediaRecorder.stream.getTracks().forEach(track => track.stop());
                }
                socket.emit('stop_listening');
                isListening = false;
                
                // Update UI with safe element access
                if (siriOrb) siriOrb.classList.remove('listening');
                if (statusText) statusText.textContent = 'Ready to listen';
                if (backgroundOverlay) backgroundOverlay.classList.remove('active');
                if (titleContainer) titleContainer.classList.remove('hidden');
                if (instructionText) instructionText.classList.remove('hidden');
                hideTranscript();
                hideResponse();
                
                // Update button states
                if (startBtn) startBtn.disabled = false;
                if (stopBtn) stopBtn.disabled = true;
            }
        }

        function showStatus(message) {
            if (statusText) statusText.textContent = message;
            setTimeout(() => {
                if (!isListening && statusText) {
                    statusText.textContent = 'Ready to listen';
                }
            }, 3000);
        }

        function showTranscript(text) {
            if (liveTranscript) liveTranscript.textContent = text;
            if (transcriptContainer) transcriptContainer.classList.add('active');
            
            // Auto-hide after 3 seconds if no new text
            if (transcriptContainer) {
                clearTimeout(transcriptContainer.timeout);
                transcriptContainer.timeout = setTimeout(() => {
                    hideTranscript();
                }, 3000);
            }
        }

        function hideTranscript() {
            if (transcriptContainer) transcriptContainer.classList.remove('active');
        }

        function showResponse(text) {
            responseCard.textContent = text;
            responseContainer.classList.add('active');
            
            // Show thinking animation
            siriOrb.classList.add('thinking');
            setTimeout(() => {
                siriOrb.classList.remove('thinking');
            }, 2000);
            
            // Auto-hide after 5 seconds
            clearTimeout(responseContainer.timeout);
            responseContainer.timeout = setTimeout(() => {
                hideResponse();
            }, 5000);
        }

        function hideResponse() {
            responseContainer.classList.remove('active');
        }

        function playAudio(base64Audio) {
            const audio = new Audio('data:audio/mp3;base64,' + base64Audio);
            audio.play().catch(e => {
                console.log('Audio playback failed:', e);
            });
        }

        // Handle page unload
        window.addEventListener('beforeunload', function() {
            if (isListening) {
                socket.emit('stop_listening');
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' && !e.target.matches('input, textarea')) {
                e.preventDefault();
                if (!isListening) {
                    startListening();
                } else {
                    stopListening();
                }
            }
        });
    </script>
</body>
</html> 
</html> 